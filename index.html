<!DOCTYPE html>
<html lang="ky">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Osh Terminal Pro | Final 2025</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root { 
            --primary: #0044cc; --accent: #ffcc00; --success: #2ecc71; 
            --danger: #e74c3c; --bg: #f0f2f5; --white: #ffffff; --dark: #1a1a1a;
        }
        
        body { margin: 0; font-family: 'Montserrat', sans-serif; background: var(--bg); color: var(--dark); overflow-x: hidden; }

        header { 
            background: var(--white); padding: 15px 8%; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); position: sticky; top:0; z-index:1000;
        }
        .logo-box { display: flex; align-items: center; gap: 12px; text-decoration: none; color: inherit; }
        .logo-icon { 
            background: var(--primary); width: 45px; height: 45px; border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; color: var(--accent); font-weight: 900; font-size: 24px;
        }

        .hero { 
            background: linear-gradient(135deg, rgba(0,68,204,0.9), rgba(0,34,136,0.9)), url('https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?q=80&w=1200');
            background-size: cover; background-position: center; padding: 60px 8% 100px; text-align: center; color: white;
        }

        .search-container { max-width: 1000px; margin: -50px auto 40px; padding: 0 20px; }
        .search-bar { 
            background: white; padding: 15px; border-radius: 25px; display: flex; flex-wrap: wrap; gap: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15); align-items: center;
        }
        .search-group { flex: 1; min-width: 150px; display: flex; flex-direction: column; padding: 0 15px; border-right: 1px solid #eee; }
        .search-group label { font-size: 10px; font-weight: 800; color: #999; margin-bottom: 5px; }
        .search-group select, .search-group input { border: none; font-weight: 700; outline: none; font-size: 15px; background: none; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 15px 30px; border-radius: 18px; font-weight: 800; cursor: pointer; transition: 0.3s; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: white; padding: 20px; border-radius: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-bottom: 4px solid var(--primary); }
        .stat-card h3 { margin: 10px 0 0; font-size: 28px; color: var(--primary); }
        .stat-card p { margin: 0; font-size: 12px; color: #777; font-weight: 600; text-transform: uppercase; }

        section { padding: 40px 8%; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }
        .route-card { 
            background: white; border-radius: 25px; padding: 25px; position: relative; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.05); transition: 0.3s; border-top: 6px solid var(--primary);
        }
        .status-tag { position: absolute; top: 15px; right: 20px; padding: 6px 14px; border-radius: 20px; font-size: 10px; font-weight: 800; }
        .st-waiting { background: #f0f0f0; color: #888; }
        .st-boarding { background: #e3f2fd; color: #1976d2; }
        .st-departed { background: #efebe9; color: #5d4037; }
        .st-delayed { background: var(--accent); color: #333; }
        .st-cancelled { background: var(--danger); color: white; }

        .ticket-box { width: 100%; max-width: 400px; margin: auto; filter: drop-shadow(0 15px 30px rgba(0,0,0,0.4)); text-align: left; }
        .t-top { background: linear-gradient(135deg, #0044cc, #002288); color: white; padding: 20px; border-radius: 20px 20px 0 0; }
        .t-mid { background: white; padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; border-left: 1px solid #ddd; border-right: 1px solid #ddd; }
        .t-divider { height: 20px; background: white; border-top: 2px dashed #ddd; position: relative; }
        .t-divider::before, .t-divider::after { content:''; position: absolute; width:20px; height:20px; border-radius:50%; background:#1a1a1a; top:-11px; }
        .t-divider::before { left: -10px; } .t-divider::after { right: -10px; }
        .t-bottom { background: white; padding: 20px; border-radius: 0 0 20px 20px; }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; align-items: center; justify-content: center; padding: 20px; overflow-y: auto; }
        #adminPanel { display: none; background: white; margin: 20px 8%; padding: 30px; border-radius: 30px; border: 1px solid #ddd; }
    </style>
</head>
<body>

<header>
    <a href="#" class="logo-box">
        <div class="logo-icon">O</div>
        <div style="line-height: 1;"><b>OSH</b><br><small>TERMINAL</small></div>
    </a>
    <div style="display:flex; gap:15px;">
        <button onclick="loginAdmin()" style="border:none; background:none; color:var(--danger); cursor:pointer; font-weight:800;">ADMIN</button>
        <select id="lang" onchange="translatePage()" style="padding: 5px; border-radius: 8px; font-weight: bold;">
            <option value="ky">KG</option>
            <option value="ru">RU</option>
            <option value="en">EN</option>
        </select>
    </div>
</header>

<div class="hero">
    <h1 id="h-title">–°–∞–ø–∞—Ä—ã“£—ã–∑ –±–∞–π—Å–∞–ª–¥—É—É –±–æ–ª—Å—É–Ω!</h1>
    <p id="h-desc">–û—à —à–∞–∞—Ä—ã–Ω—ã–Ω –∑–∞–º–∞–Ω–±–∞–ø –æ–Ω–ª–∞–π–Ω –±—Ä–æ–Ω–¥–æ–æ —Å–∏—Å—Ç–µ–º–∞—Å—ã</p>
</div>

<div class="search-container">
    <div class="search-bar">
        <div class="search-group">
            <label id="l-to">–ö–ê–Ø–ö–ö–ê</label>
            <select id="s-to">
                <option value="–ë–∏—à–∫–µ–∫">–ë–∏—à–∫–µ–∫</option>
                <option value="–ñ–∞–ª–∞–ª-–ê–±–∞–¥">–ñ–∞–ª–∞–ª-–ê–±–∞–¥</option>
                <option value="–ë–∞—Ç–∫–µ–Ω">–ë–∞—Ç–∫–µ–Ω</option>
                <option value="–ù–∞—Ä—ã–Ω">–ù–∞—Ä—ã–Ω</option>
            </select>
        </div>
        <div class="search-group">
            <label id="l-date">–î–ê–¢–ê</label>
            <input type="date" id="s-date">
        </div>
        <button class="btn-main" id="b-search" onclick="renderRoutes()">–ò–ó–î”®”®</button>
    </div>
</div>

<section id="adminPanel">
    <h2 id="a-title">–ë–∞—à–∫–∞—Ä—É—É –∂–∞–Ω–∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
    <div class="stats-grid">
        <div class="stat-card"><p id="st-1">–ö–∏—Ä–µ—à–µ</p><h3 id="stat-money">0</h3></div>
        <div class="stat-card"><p id="st-2">–ë–∏–ª–µ—Ç—Ç–µ—Ä</p><h3 id="stat-count">0</h3></div>
        <div class="stat-card"><p id="st-3">–†–µ–π—Å—Ç–µ—Ä</p><h3 id="stat-routes">0</h3></div>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; background: #f9f9f9; padding: 20px; border-radius: 20px;">
        <input id="a-code" placeholder="–ö–æ–¥">
        <input id="a-to" placeholder="–ö–∞—è–∫–∫–∞">
        <input id="a-date" type="date">
        <input id="a-time" type="time">
        <input id="a-car" placeholder="–£–Ω–∞–∞">
        <input id="a-num" placeholder="–ù–æ–º–µ—Ä">
        <input id="a-price" type="number" placeholder="–ë–∞–∞—Å—ã">
        <button class="btn-main" style="background:var(--success)" onclick="addRoute()">OK</button>
    </div>
    <div style="overflow-x: auto; margin-top: 20px;">
        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
            <thead><tr style="text-align: left; color: #888;"><th>–ö–æ–¥</th><th>–ë–∞–≥—ã—Ç</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ê—Ä–∞–∫–µ—Ç</th></tr></thead>
            <tbody id="adminTable"></tbody>
        </table>
    </div>
</section>

<section>
    <h2 id="t-board">–†–µ–π—Å—Ç–µ—Ä–¥–∏–Ω —Ç–∞–±–ª–æ—Å—É</h2>
    <div class="grid" id="routesGrid"></div>
</section>

<div id="modal" class="modal"><div id="modalInner"></div></div>

<script>
    let db = JSON.parse(localStorage.getItem('osh_pro_v1')) || [];
    let sales = JSON.parse(localStorage.getItem('osh_pro_sales')) || {};
    let lang = 'ky';

    const words = {
        ky: { 
            h_title: "–°–∞–ø–∞—Ä—ã“£—ã–∑ –±–∞–π—Å–∞–ª–¥—É—É –±–æ–ª—Å—É–Ω!", h_desc: "–û—à —à–∞–∞—Ä—ã–Ω—ã–Ω –∑–∞–º–∞–Ω–±–∞–ø –æ–Ω–ª–∞–π–Ω –±—Ä–æ–Ω–¥–æ–æ —Å–∏—Å—Ç–µ–º–∞—Å—ã",
            l_to: "–ö–ê–Ø–ö–ö–ê", l_date: "–î–ê–¢–ê", b_search: "–ò–ó–î”®”®", t_board: "–†–µ–π—Å—Ç–µ—Ä–¥–∏–Ω —Ç–∞–±–ª–æ—Å—É",
            buy: "–ë–∏–ª–µ—Ç –∞–ª—É—É", waiting: "–ö“Ø—Ç“Ø“Ø–¥”©", boarding: "–û—Ç—É—Ä–≥—É–∑—É—É", departed: "–ö–µ—Ç—Ç–∏", delayed: "–ö–∞—Ä–º–∞–ª–¥—ã", cancelled: "–ö–∞–π—Ç–∞—Ä—ã–ª–¥—ã",
            st_1: "–ö–∏—Ä–µ—à–µ", st_2: "–ë–∏–ª–µ—Ç—Ç–µ—Ä", st_3: "–†–µ–π—Å—Ç–µ—Ä", a_title: "–ë–∞—à–∫–∞—Ä—É—É –∂–∞–Ω–∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
            m_seat: "–û—Ä—É–Ω —Ç–∞–Ω–¥–∞“£—ã–∑", m_close: "–ñ–∞–±—É—É", p_name: "–ê—Ç—ã-–∂”©–Ω“Ø“£“Ø–∑:",
            t_issue: "–°–∞—Ç—ã–ª–≥–∞–Ω –∫“Ø–Ω“Ø", t_pass: "–ñ“Æ–†–ì“Æ–ù–ß“Æ", t_num: "–ë–ò–õ–ï–¢ ‚Ññ", t_date: "–ö“Æ–ù“Æ", t_time: "–£–ë–ê–ö–¢–´", t_car: "–£–ù–ê–ê", t_plate: "–ú–ê–ú. –ù–û–ú–ï–†", t_seat: "–û–†–£–ù",
            t_warn: "–≠–°–ö–ï–†–¢“Æ“Æ", t_msg: "* –£–Ω–∞–∞ –∂”©–Ω”©—Ä–≥”© 30 –º“Ø–Ω”©—Ç –∫–∞–ª–≥–∞–Ω–¥–∞ –∫–µ–ª–∏“£–∏–∑.<br>* –ë–∏–ª–µ—Ç—Ç–∏ –∞–π–¥–æ–æ—á—É–≥–∞ –∫”©—Ä—Å”©—Ç“Ø“£“Ø–∑.<br>* –°–∞–ø–∞—Ä–¥–∞ –∫–æ–æ–ø—Å—É–∑–¥—É–∫—Ç—É —Å–∞–∫—Ç–∞“£—ã–∑.",
            t_save: "–°–ê–ö–¢–û–û (PNG)", t_exit: "–ß–´–ì–£–£"
        },
        ru: { 
            h_title: "–°—á–∞—Å—Ç–ª–∏–≤–æ–≥–æ –ø—É—Ç–∏!", h_desc: "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –û—à",
            l_to: "–ö–£–î–ê", l_date: "–î–ê–¢–ê", b_search: "–ü–û–ò–°–ö", t_board: "–¢–∞–±–ª–æ —Ä–µ–π—Å–æ–≤",
            buy: "–ö—É–ø–∏—Ç—å –±–∏–ª–µ—Ç", waiting: "–û–∂–∏–¥–∞–Ω–∏–µ", boarding: "–ü–æ—Å–∞–¥–∫–∞", departed: "–£–µ—Ö–∞–ª", delayed: "–ó–∞–¥–µ—Ä–∂–∞–Ω", cancelled: "–û—Ç–º–µ–Ω–µ–Ω",
            st_1: "–î–æ—Ö–æ–¥", st_2: "–ë–∏–ª–µ—Ç—ã", st_3: "–†–µ–π—Å—ã", a_title: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
            m_seat: "–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ", m_close: "–ó–∞–∫—Ä—ã—Ç—å", p_name: "–í–∞—à–µ –∏–º—è:",
            t_issue: "–î–∞—Ç–∞ –ø—Ä–æ–¥–∞–∂–∏", t_pass: "–ü–ê–°–°–ê–ñ–ò–†", t_num: "–ë–ò–õ–ï–¢ ‚Ññ", t_date: "–î–ê–¢–ê", t_time: "–í–†–ï–ú–Ø", t_car: "–ê–í–¢–û", t_plate: "–ì–û–°. –ù–û–ú–ï–†", t_seat: "–ú–ï–°–¢–û",
            t_warn: "–í–ù–ò–ú–ê–ù–ò–ï", t_msg: "* –ü—Ä–∏–±—É–¥—å—Ç–µ –∑–∞ 30 –º–∏–Ω—É—Ç –¥–æ –≤—ã–µ–∑–¥–∞.<br>* –ü–æ–∫–∞–∂–∏—Ç–µ –±–∏–ª–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—é.<br>* –°–æ–±–ª—é–¥–∞–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.",
            t_save: "–°–û–•–†–ê–ù–ò–¢–¨", t_exit: "–í–´–•–û–î"
        },
        en: { 
            h_title: "Have a nice trip!", h_desc: "Modern booking system of Osh city",
            l_to: "TO", l_date: "DATE", b_search: "SEARCH", t_board: "Departure Board",
            buy: "Get Ticket", waiting: "Waiting", boarding: "Boarding", departed: "Departed", delayed: "Delayed", cancelled: "Cancelled",
            st_1: "Revenue", st_2: "Tickets", st_3: "Routes", a_title: "Admin & Statistics",
            m_seat: "Select Seat", m_close: "Close", p_name: "Full Name:",
            t_issue: "Date of Issue", t_pass: "PASSENGER", t_num: "TICKET ‚Ññ", t_date: "DATE", t_time: "TIME", t_car: "VEHICLE", t_plate: "PLATE", t_seat: "SEAT",
            t_warn: "ATTENTION", t_msg: "* Arrive 30 minutes before departure.<br>* Show this ticket to the driver.<br>* Stay safe during travel.",
            t_save: "SAVE PNG", t_exit: "EXIT"
        }
    };

    function translatePage() {
        lang = document.getElementById('lang').value;
        const w = words[lang];
        document.getElementById('h-title').innerText = w.h_title;
        document.getElementById('h-desc').innerText = w.h_desc;
        document.getElementById('l-to').innerText = w.l_to;
        document.getElementById('l-date').innerText = w.l_date;
        document.getElementById('b-search').innerText = w.b_search;
        document.getElementById('t-board').innerText = w.t_board;
        document.getElementById('st-1').innerText = w.st_1;
        document.getElementById('st-2').innerText = w.st_2;
        document.getElementById('st-3').innerText = w.st_3;
        document.getElementById('a-title').innerText = w.a_title;
        renderRoutes();
    }

    // --- –ê–í–¢–û–ú–ê–¢–¢–´–ö –°–¢–ê–¢–£–° –ñ–ê–ù–ê ”®–ß“Æ–†“Æ“Æ ---
    function autoUpdateStatus() {
        const now = new Date();
        let changed = false;
        db.forEach((r, index) => {
            const rTime = new Date(`${r.date}T${r.time}`);
            const diffMin = (rTime - now) / 60000;

            // 1 —Å–∞–∞—Ç—Ç–∞–Ω –∫–∏–π–∏–Ω —Ç–∞–±–ª–æ–¥–æ–Ω ”©—á“Ø—Ä“Ø“Ø
            if (diffMin <= -60) {
                db.splice(index, 1);
                changed = true;
                return;
            }

            // –ê–≤—Ç–æ-—Å—Ç–∞—Ç—É—Å—Ç–∞—Ä
            if (['waiting', 'boarding', 'departed'].includes(r.status)) {
                let ns = r.status;
                if (diffMin <= 0) ns = 'departed';
                else if (diffMin <= 30) ns = 'boarding';
                else ns = 'waiting';

                if (r.status !== ns) { r.status = ns; changed = true; }
            }
        });
        if (changed) save();
    }
    setInterval(autoUpdateStatus, 15000);

    function addRoute() {
        const r = {
            id: Date.now().toString(),
            code: document.getElementById('a-code').value,
            to: document.getElementById('a-to').value,
            date: document.getElementById('a-date').value,
            time: document.getElementById('a-time').value,
            car: document.getElementById('a-car').value,
            num: document.getElementById('a-num').value,
            price: document.getElementById('a-price').value,
            status: 'waiting'
        };
        if(r.code && r.to) { db.push(r); save(); }
    }

    function renderRoutes() {
        const grid = document.getElementById('routesGrid');
        grid.innerHTML = "";
        db.forEach(r => {
            const stText = words[lang][r.status] || r.status;
            grid.innerHTML += `
                <div class="route-card">
                    <span class="status-tag st-${r.status}">${stText}</span>
                    <small>#${r.code}</small>
                    <h3 style="margin: 10px 0;">–û–® ‚ûî ${r.to.toUpperCase()}</h3>
                    <p style="font-size:13px; color:#777;">üìÖ ${r.date} | ‚è∞ ${r.time}<br>üöê ${r.car} (${r.num})</p>
                    <div style="font-size: 22px; font-weight: 800; color: var(--success); margin: 15px 0;">${r.price} SOM</div>
                    <button class="btn-main" style="width: 100%;" onclick="openBooking('${r.id}')">${words[lang].buy}</button>
                </div>
            `;
        });
        renderAdmin();
        updateStats();
    }

    function updateStats() {
        let m = 0, c = 0;
        Object.keys(sales).forEach(id => {
            const r = db.find(x => x.id === id);
            if(r) { c += sales[id].length; m += sales[id].length * parseInt(r.price); }
        });
        document.getElementById('stat-money').innerText = m;
        document.getElementById('stat-count').innerText = c;
        document.getElementById('stat-routes').innerText = db.length;
    }

    function openBooking(id) {
        const r = db.find(x => x.id === id);
        if(!sales[id]) sales[id] = [];
        let seats = "";
        for(let i=1; i<=16; i++) {
            const taken = sales[id].includes(i);
            seats += `<div onclick="${taken?'':'confirmBook(\''+id+'\','+i+')'}" style="width:35px; height:35px; background:${taken?'#ddd':'#2ecc71'}; color:white; border-radius:8px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-weight:800; font-size:12px;">${i}</div>`;
        }
        document.getElementById('modalInner').innerHTML = `
            <div style="background:white; padding:30px; border-radius:30px; text-align:center; max-width:350px;">
                <h3>${r.to} | ${words[lang].m_seat}</h3>
                <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; margin:20px 0;">${seats}</div>
                <button class="btn-main" style="background:#333; width:100%;" onclick="closeModal()">${words[lang].m_close}</button>
            </div>
        `;
        document.getElementById('modal').style.display = 'flex';
    }

    function confirmBook(id, seat) {
        const name = prompt(words[lang].p_name);
        if(!name) return;
        sales[id].push(seat);
        localStorage.setItem('osh_pro_sales', JSON.stringify(sales));
        showTicket(id, name, seat);
    }

    function showTicket(id, name, seat) {
        const r = db.find(x => x.id === id);
        const w = words[lang];
        const tID = Math.floor(100000 + Math.random() * 900000);
        const now = new Date();
        const pDate = now.toLocaleString();

        document.getElementById('modalInner').innerHTML = `
            <div id="ticket-print" class="ticket-box">
                <div class="t-top">
                    <div style="display:flex; justify-content:space-between; font-size:10px;"><b>OSH TERMINAL PRO</b> <span>BOARDING PASS</span></div>
                    <h2 style="margin:15px 0 5px;">–û–® ‚ûî ${r.to.toUpperCase()}</h2>
                    <div style="font-size:9px; opacity:0.8;">${w.t_issue}: ${pDate}</div>
                </div>
                <div class="t-mid">
                    <div><small style="color:#999;">${w.t_pass}</small><br><b>${name}</b></div>
                    <div style="text-align:right;"><small style="color:#999;">${w.t_num}</small><br><b style="color:var(--danger);">${tID}</b></div>
                    <div><small style="color:#999;">${w.t_date}</small><br><b>${r.date}</b></div>
                    <div style="text-align:right;"><small style="color:#999;">${w.t_time}</small><br><b style="font-size:18px; color:var(--primary);">${r.time}</b></div>
                    <div><small style="color:#999;">${w.t_car}</small><br><b>${r.car}</b></div>
                    <div style="text-align:right;"><small style="color:#999;">${w.t_plate}</small><br><b>${r.num}</b></div>
                </div>
                <div class="t-divider"></div>
                <div class="t-bottom" style="flex-direction: column; align-items: stretch; display: flex;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 20px;">
                        <div><small style="color:#999;">${w.t_seat}</small><br><b style="font-size:32px; color:var(--success); line-height:1;">${seat}</b></div>
                        <div id="qr"></div>
                    </div>
                    <div style="border-top: 1px solid #eee; padding: 15px 20px; text-align: left; background: #fafafa; border-radius: 0 0 20px 20px;">
                        <b style="font-size: 9px; color: var(--danger);">${w.t_warn}:</b>
                        <p style="font-size: 8px; color: #666; margin: 3px 0 0; line-height: 1.2;">${w.t_msg}</p>
                    </div>
                </div>
            </div>
            <div style="margin-top:20px; display:flex; gap:10px; justify-content:center;">
                <button class="btn-main" style="background:var(--success)" onclick="downloadTicket()">${w.t_save}</button>
                <button class="btn-main" style="background:#fff; color:#333" onclick="closeModal()">${w.t_exit}</button>
            </div>
        `;
        setTimeout(() => { new QRCode(document.getElementById("qr"), { text: "VERIFY-"+tID, width: 60, height: 60 }); }, 100);
    }

    function renderAdmin() {
        const table = document.getElementById('adminTable');
        table.innerHTML = "";
        db.forEach(r => {
            table.innerHTML += `
                <tr style="border-bottom:1px solid #eee;">
                    <td style="padding:10px;">#${r.code}</td><td>${r.to}</td>
                    <td>
                        <select onchange="updateStatus('${r.id}', this.value)" style="font-size:11px;">
                            <option value="waiting" ${r.status==='waiting'?'selected':''}>${words[lang].waiting}</option>
                            <option value="boarding" ${r.status==='boarding'?'selected':''}>${words[lang].boarding}</option>
                            <option value="departed" ${r.status==='departed'?'selected':''}>${words[lang].departed}</option>
                            <option value="delayed" ${r.status==='delayed'?'selected':''}>${words[lang].delayed}</option>
                            <option value="cancelled" ${r.status==='cancelled'?'selected':''}>${words[lang].cancelled}</option>
                        </select>
                    </td>
                    <td><button onclick="deleteRoute('${r.id}')" style="border:none; background:none; cursor:pointer;">‚ùå</button></td>
                </tr>
            `;
        });
    }

    function updateStatus(id, st) { const i = db.findIndex(x => x.id === id); db[i].status = st; save(); }
    function deleteRoute(id) { if(confirm("Delete?")) { db = db.filter(x => x.id !== id); save(); } }
    function save() { localStorage.setItem('osh_pro_v1', JSON.stringify(db)); renderRoutes(); }
    function loginAdmin() { if(prompt("Pass:") === "admin777") document.getElementById('adminPanel').style.display = 'block'; }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    function downloadTicket() { 
        html2canvas(document.getElementById('ticket-print'), { scale: 2 }).then(canvas => { 
            const link = document.createElement('a');
            link.download = 'OshTerminal-Ticket.png';
            link.href = canvas.toDataURL();
            link.click();
        }); 
    }

    window.onload = translatePage;
</script>
</body>
</html>
